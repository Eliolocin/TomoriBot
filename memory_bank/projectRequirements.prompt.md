As you complete tasks and reference relevant files, update this file as our memory to help with future tasks and to keep track of our progress.

# TomoriBot Project Requirements Document (PRD)

| ID  | Dependencies | Category        | Description                                  | User Story                                                                                                                            | Expected Behavior/Outcome                                                                            | Priority | Status          | Acceptance Criteria                                                                   |
| --- | ------------ | --------------- | -------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | -------- | --------------- | ------------------------------------------------------------------------------------- |
| 1.1 |              | Personality     | Personality customization via slash command  | As a Discord server member, I want to change Tomori's personality via a slash command, including attribute lists and sample dialogues | Slash command `/teach` allows view/edit/delete/add of personality attributes and dialogue samples    | High     | In Progress     | Users can confirm changes via response messages and view updated attributes/dialogues |
| 1.2 |              | Memory System   | Server-based memory management               | As a member, I want to change Tomori’s memory of the server through a slash command                                                   | Users can add/delete server-specific memory entries using `/teach` commands                          | High     | In Progress     | Updated memory shows on `/status` and is persisted                                    |
| 1.3 |              | Memory System   | User-based memory management                 | As a member, I want Tomori to remember me across servers                                                                              | `/teach` command updates personal memory, persists across servers                                    | High     | In Progress     | User memory appears in `/status` and reflects changes                                 |
| 1.4 |              | Admin Config    | Admin settings for LLM API & model           | As an admin, I want to change LLM API keys and model used                                                                             | Server admins can view/set API keys and select from available models                                 | High     | Not yet started | Only admins can modify settings, API keys are stored securely                         |
| 1.5 |              | Localization    | User language preference                     | As a user, I want to change the language Tomori uses to interact                                                                      | Users can set their preferred language, and Tomori responds accordingly                              | Medium   | Not yet started | Language setting persists and affects future replies                                  |
| 1.6 |              | Onboarding      | Intro message on server join                 | As an admin, I want an intro message to help set up Tomori easily                                                                     | When Tomori joins, she sends a welcome `/setup` message for onboarding                               | High     | Not yet started | Message appears on join, provides useful links/instructions                           |
| 1.7 |              | Help & UI       | Help command                                 | As a member, I want a `/help` command to view Tomori’s features                                                                       | Slash command `/help` shows a categorized, readable list of commands and usage                       | High     | In Progress     | All implemented commands are listed in `/help` with descriptions                      |
| 1.8 | 1.2, 1.3     | Status          | View status and memory                       | As a member, I want to see current memory and personality via `/status`                                                               | Tomori shows server memory, user memory, and personality summary                                     | Medium   | Not yet started | Output is accurate and reflects latest data                                           |
| 2.1 |              | Personalization | Change Tomori's nickname                     | As a member, I want to change how Tomori refers to herself and how others call her                                                    | Slash command changes her nickname/reference name                                                    | Medium   | In Progress     | Tomori uses updated nickname in responses                                             |
| 2.2 |              | Personalization | Change user nickname                         | As a member, I want Tomori to use a custom name for me                                                                                | Slash command allows setting a preferred name for Tomori to use                                      | Medium   | In Progress     | Tomori consistently uses the new name                                                 |
| 2.3 |              | Extra Features  | Image gen and scraping                       | As a member, I want access to image generation and board scraping                                                                     | Tomori can generate images or scrape boorus (e.g. Danbooru)                                          | Low      | In Progress     | Images are returned via slash or message command                                      |
| 2.4 | 1.1          | Personality     | Personality presets                          | As a member, I want quick-access preset personalities for Tomori                                                                      | Slash command `/teach preset` lists and allows selecting personality presets                         | Medium   | In Progress     | Preset personalities load immediately and reflect in behavior                         |
| 2.5 | 1.1, 2.4     | Personality     | Online-style speaking personality            | As a member, I want Tomori to talk in an informal, Turing-test-passing style                                                          | Tomori uses lowercase, net slang, and short text when this mode is enabled                           | Low      | In Progress     | Enabled via flag, toggles behavior style                                              |
| 2.6 | 1.1, 2.4     | Extra Features  | Auto-messaging                               | As a member, I want Tomori to volitionally type in chat to induce conversation                                                        | After setting up settings, Tomori automatically messages in chat after X messages in select channels | Low      | In Progress     | Enabled via flag, only works on select channels                                       |
| 3.1 |              | Currency        | Multiple income sources for TomoCoins        | As a member, I want to earn TomoCoins through dailies, coin flips, slots                                                              | Slash commands for `/daily`, `/gamba` give coins                                                     | Medium   | In Progress     | Coins are stored per user and returned accurately                                     |
| 3.2 |              | Currency        | Standard economy features                    | As a member, I want to check balance, deposit/withdraw/donate coins                                                                   | `/balance`, `/deposit`, `/withdraw`, `/donate` commands available                                    | Medium   | Pending testing | Each function adjusts TomoCoins as expected                                           |
| 3.3 | 3.1, 3.2     | Admin Config    | Permissions and currency gating for settings | As an admin, I want to restrict customization using TomoCoins                                                                         | Admins can configure memory editing or preset switching to cost coins                                | High     | In Progress     | Permissions are respected and costs deducted properly                                 |
| 4.1 |              | DevOps          | Migrate from MongoDB to PostgreSQL           | As a Developer, I want to migrate to PostgreSQL for better ACID/compliance                                                            | New DB schema replaces MongoDB. Queries and storage are all rewritten                                | High     | Not yet started | MongoDB is fully removed and Tomori runs on Postgres without errors                   |
| 4.2 |              | Refactoring     | Refactor `teach.ts` into modular files       | As a Developer, I want to split monolithic code for maintainability                                                                   | Break `teach.ts` into smaller modules (e.g., personality.ts, memory.ts, etc.)                        | High     | Not yet started | File is fully modularized and builds successfully                                     |
| 4.3 |              | Security        | Secure API key storage                       | As a Developer, I want to protect API keys from exposure                                                                              | Keys stored securely, encrypted, not exposed in logs or code                                         | High     | Not yet started | Keys are no longer visible or hardcoded anywhere in code                              |
| 4.4 |              | UX / Support    | Create `/support` command                    | As a Developer, I want users to have a way to support me                                                                              | Slash command returns support info, links to Ko-fi, GitHub, etc.                                     | Medium   | Not yet started | Command works and is accessible in `/help`                                            |
